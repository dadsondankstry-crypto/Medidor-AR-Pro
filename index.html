<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medidor AR Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #ui {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; text-align: center; color: white; 
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px; width: 85%;
        }
        button {
            background: #ff4444; color: white; border: none; padding: 10px 20px;
            border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="msg">Aponte a câmera e clique para marcar o Ponto A</div>
        <button onclick="resetar()">Limpar Medição</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        <a-camera position="0 0 0"></a-camera>
        <a-entity id="pontos-container"></a-entity>
    </a-scene>

    <script>
        // Registro do Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log("SW registrado com sucesso!"));
        }

        let pontos = [];
        const container = document.querySelector('#pontos-container');
        const display = document.querySelector('#msg');

        window.addEventListener('click', function () {
            const camera = document.querySelector('a-camera');
            const posicao = new THREE.Vector3();
            camera.object3D.getWorldPosition(posicao);
            
            // Criar marcador visual
            const esfera = document.createElement('a-sphere');
            esfera.setAttribute('position', `${posicao.x} ${posicao.y} ${posicao.z}`);
            esfera.setAttribute('radius', '0.03');
            esfera.setAttribute('color', '#00ff00');
            container.appendChild(esfera);
            
            pontos.push(posicao.clone());

            if (pontos.length >= 2) {
                const p1 = pontos[pontos.length - 2];
                const p2 = pontos[pontos.length - 1];
                const dist = p1.distanceTo(p2);
                display.innerHTML = `<strong>Distância: ${dist.toFixed(2)} metros</strong>`;
            } else {
                display.innerText = "Ponto A marcado. Agora marque o Ponto B.";
            }
        });

        function resetar() {
            pontos = [];
            container.innerHTML = '';
            display.innerText = "Aponte e clique para marcar o Ponto A";
        }
    </script>
</body>
</html>